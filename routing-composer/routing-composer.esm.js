var Ae=Object.defineProperty;var Re=(k,n,a)=>n in k?Ae(k,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):k[n]=a;var ge=(k,n,a)=>Re(k,typeof n!="symbol"?n+"":n,a);import"react";import pe from"react-dom";import{useEffect as de,useState as he}from"react";import Ve from"react-dom";import{useEffect as te,useState as le,useRef as ve}from"react";import"react";import{Fragment as ne,jsx as u,jsxs as F}from"react/jsx-runtime";var Te="rounded-2xl shadow-lg border border-white/10 bg-neutral-900/70 backdrop-blur p-3 select-none",be="px-3 py-1 rounded-xl border border-white/10 shadow hover:bg-white/5 active:scale-[.98] transition";function z({label:k,min:n,max:a,step:t=.01,value:i,onChange:r,suffix:h}){let c=typeof i=="number"?(Math.round(i*100)/100).toFixed(2):String(i??""),e=Number(i??0),p=Number(n??0),l=Number(a??1),x=Math.max(0,Math.min(1,(e-p)/(l-p)))*100;return F("div",{className:"flex items-center gap-3",children:[u("div",{className:"w-24 text-sm opacity-80",children:k}),u("input",{type:"range",className:"w-48 rc-slider",min:n,max:a,step:t,value:Number(i??0),onChange:_=>r(Number(_.target.value)),onMouseUp:_=>_.currentTarget.blur(),onTouchEnd:_=>_.currentTarget.blur(),style:{"--rc-pos":`${x}%`}}),F("div",{className:"w-20 tabular-nums text-right text-xs opacity-70",children:[c,h?u("span",{className:"opacity-60",children:h}):null]})]})}function ue({mod:k,onToggle:n,onRemove:a,onParam:t,onDragStart:i}){let{kind:r,enabled:h,params:c={}}=k;return F("div",{className:`${Te} w-[280px]`,children:[F("div",{className:"flex items-center justify-between",children:[F("div",{className:"flex items-center gap-2",children:[u("div",{className:"cursor-grab active:cursor-grabbing text-xs opacity-60 select-none",draggable:!!i,onDragStart:i,title:"Drag to reorder",children:"\u2630"}),u("div",{className:"font-semibold capitalize",children:r})]}),F("div",{className:"flex gap-2",children:[u("button",{className:be,onClick:n,children:h?"Bypass":"Enable"}),u("button",{className:be,onClick:a,title:"Remove module",children:"\xD7"})]})]}),u("div",{className:"mt-2 text-xs opacity-70",children:h?"active":"bypassed"}),F("div",{className:"mt-3 space-y-2",children:[r==="ks_source"&&F(ne,{children:[F("div",{className:"flex items-center gap-2",children:[u("div",{className:"w-24 text-sm opacity-80",children:"MIDI ch"}),F("select",{className:"bg-neutral-900 text-white border border-white/20 rounded-lg px-2 py-1 text-sm",value:String(c.ch??"all"),onChange:e=>{t("ch",e.target.value),e.target.blur()},children:[u("option",{value:"all",children:"all"}),Array.from({length:16},(e,p)=>u("option",{value:String(p),children:p},p))]})]}),F("div",{className:"flex items-center gap-2",children:[u("div",{className:"w-24 text-sm opacity-80",children:"Program"}),F("select",{className:"bg-neutral-900 text-white border border-white/20 rounded-lg px-2 py-1 text-sm",value:String(c.program??"all"),onChange:e=>{t("program",e.target.value),e.target.blur()},children:[u("option",{value:"all",children:"all"}),Array.from({length:128},(e,p)=>u("option",{value:String(p),children:p},p))]})]}),F("div",{className:"flex items-center gap-2",children:[u("div",{className:"w-24 text-sm opacity-80",children:"smoothing"}),u("select",{className:"bg-neutral-900 text-white border border-white/20 rounded-lg px-2 py-1 text-sm",value:String(c.smoothingMode??"auto"),onChange:e=>{t("smoothingMode",e.target.value),e.target.blur()},children:["auto","manual"].map(e=>u("option",{value:e,children:e},e))})]}),String(c.smoothingMode??"auto")==="manual"&&u(z,{label:"smooth",min:0,max:1,value:Number(c.smoothingFactor??.2),onChange:e=>t("smoothingFactor",e)}),u(z,{label:"velScale",min:0,max:1,value:Number(c.velScale??1),onChange:e=>t("velScale",e)}),u(z,{label:"KS dur",min:.1,max:10,step:.1,value:Number(c.ksDurSec??1),onChange:e=>t("ksDurSec",e),suffix:"s"}),u(z,{label:"Release",min:0,max:1,step:.01,value:Number(c.ksRelease??.5),onChange:e=>t("ksRelease",e)}),F("div",{className:"flex items-center gap-2",children:[u("div",{className:"w-24 text-sm opacity-80",children:"Noise"}),F("select",{className:"bg-neutral-900 text-white border border-white/20 rounded-lg px-2 py-1 text-sm",value:String(c.seedNoiseType??"pink"),onChange:e=>{t("seedNoiseType",e.target.value),e.target.blur()},children:[u("option",{value:"brown",children:"Soft"}),u("option",{value:"softBrown",children:"Extra Soft"}),u("option",{value:"red",children:"Deep Soft"}),u("option",{value:"pink",children:"Warm"}),u("option",{value:"softPink",children:"Warm Soft"}),u("option",{value:"white",children:"Bright"}),u("option",{value:"blue",children:"Airy"}),u("option",{value:"violet",children:"Breathy"}),u("option",{value:"wind",children:"Windy"}),u("option",{value:"perlin",children:"Organic"}),u("option",{value:"formant",children:"Body"}),u("option",{value:"dust",children:"Dusty"}),u("option",{value:"wood",children:"Woody"}),u("option",{value:"grey",children:"Mix"})]})]}),String(c.smoothingMode??"auto")==="auto"&&u("div",{className:"text-[11px] opacity-70",children:"auto: smoothing \u4F9D\u64DA synth.options[ch].stringDamping / variation \u8207 note \u8A08\u7B97"})]}),r==="source"&&F(ne,{children:[F("div",{className:"flex items-center gap-2",children:[u("div",{className:"w-24 text-sm opacity-80",children:"MIDI ch"}),F("select",{className:"bg-neutral-900 text-white border border-white/20 rounded-lg px-2 py-1 text-sm",value:String(k.params.ch??"all"),onChange:e=>{t("ch",e.target.value),e.target.blur()},children:[u("option",{value:"all",children:"all"}),Array.from({length:16},(e,p)=>u("option",{value:String(p),children:p},p))]})]}),F("div",{className:"flex items-center gap-2",children:[u("div",{className:"w-24 text-sm opacity-80",children:"wave"}),u("select",{className:"bg-neutral-900 text-white border border-white/20 rounded-lg px-2 py-1 text-sm",value:String(k.params.type),onChange:e=>{t("type",e.target.value),e.target.blur()},children:["sine","square","sawtooth","triangle"].map(e=>u("option",{value:e,children:e},e))})]}),u(z,{label:"attack",min:0,max:.2,value:Number(k.params.adsr?.a??.003),onChange:e=>t("adsr",{...k.params.adsr||{},a:e})}),u(z,{label:"decay",min:0,max:1,value:Number(k.params.adsr?.d??.08),onChange:e=>t("adsr",{...k.params.adsr||{},d:e})}),u(z,{label:"sustain",min:0,max:1,value:Number(k.params.adsr?.s??.4),onChange:e=>t("adsr",{...k.params.adsr||{},s:e})}),u(z,{label:"release",min:0,max:2,value:Number(k.params.adsr?.r??.2),onChange:e=>t("adsr",{...k.params.adsr||{},r:e})})]}),r==="filter"&&F(ne,{children:[F("div",{className:"flex items-center gap-2",children:[u("div",{className:"w-24 text-sm opacity-80",children:"mode"}),u("select",{className:"bg-neutral-900 text-white border border-white/20 rounded-lg px-2 py-1 text-sm",value:String(c.mode??"lowpass"),onChange:e=>{t("mode",e.target.value),e.target.blur()},children:["lowpass","highpass","bandpass","notch"].map(e=>u("option",{value:e,children:e},e))})]}),u(z,{label:"freq",min:50,max:12e3,value:Number(c.freq??1200),onChange:e=>t("freq",e)}),u(z,{label:"Q",min:.1,max:20,value:Number(c.q??.7),onChange:e=>t("q",e)})]}),r==="delay"&&F(ne,{children:[u(z,{label:"time",min:.01,max:1.2,value:Number(c.time??.25),onChange:e=>t("time",e)}),u(z,{label:"feedback",min:0,max:.95,value:Number(c.feedback??.35),onChange:e=>t("feedback",e)}),u(z,{label:"mix",min:0,max:1,value:Number(c.mix??.3),onChange:e=>t("mix",e)})]}),r==="reverb"&&F(ne,{children:[u(z,{label:"decay",min:.2,max:6,value:Number(c.decay??2),onChange:e=>t("decay",e)}),u(z,{label:"mix",min:0,max:1,value:Number(c.mix??.25),onChange:e=>t("mix",e)})]}),r==="convolver_ir"&&F(ne,{children:[F("div",{className:"flex items-center gap-2",children:[u("div",{className:"w-24 text-sm opacity-80",children:"IR"}),u("select",{className:"bg-neutral-900 text-white border border-white/20 rounded-lg px-2 py-1 text-sm",value:String(c.irId??"IR_Gibson"),onChange:e=>{t("irId",e.target.value),e.target.blur()},children:["IR_Gibson","IR_piezo"].map(e=>u("option",{value:e,children:e},e))})]}),u(z,{label:"mix",min:0,max:1,value:Number(c.mix??.3),onChange:e=>t("mix",e)})]}),r==="gain"&&u(z,{label:"gain",min:0,max:1.5,value:Number(c.gain??.8),onChange:e=>t("gain",e)}),r==="analyzer"&&u("div",{className:"text-xs opacity-70",children:"tap to scope (no sound change)"})]})]})}var ce=class{constructor(n){ge(this,"handleMIDIMsg",n=>{let a=n[0],t=n[1],i=n[2],r=a&240,h=a&15;r===144&&i>0?this.gate(!0,i/127,h,t):(r===128||r===144&&i===0)&&this.gate(!1,0,h,t)});this.midiSynth=void 0,this.actx=n||new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.actx.createGain(),this.masterGain.gain.value=.9,this.masterGain.connect(this.actx.destination),this.analyser=this.actx.createAnalyser(),this.analyser.fftSize=2048,this.liveNodes=new Map,this._bendCS=Object.create(null),this.liveNodes=new Map,this.mixers=Array.from({length:16},()=>{let a=this.actx.createGain();return a.gain.value=1,a}),setTimeout(()=>{if(this.midiSynth?.chvol)for(let a=0;a<16;a++)try{this.mixers[a].connect(this.midiSynth.chvol[a]),console.log(`[RC] mixer[ch${a}] -> chvol[ch${a}]`)}catch(t){console.warn(`[RC] mixer[ch${a}] connect failed`,t)}},1e3),setInterval(()=>{try{this.actx?.state==="suspended"&&this.actx.resume(),this.midiSynth?.actx?.state==="suspended"&&this.midiSynth.actx.resume()}catch{}},2e3)}updateGainNodeById(n,a){let t=this.liveNodes?.get(n+":node");if(!t||!t.gain)return!1;let i=this.actx.currentTime;try{t.gain.cancelScheduledValues(i),t.gain.setTargetAtTime(Number(a)||0,i,.01)}catch{t.gain.value=Number(a)||0}return!0}getBendNode(n){if(this._bendCS||(this._bendCS=Object.create(null)),n=(n|0)&15,this._bendCS[n])return this._bendCS[n];let a=this.actx.createConstantSource();return a.offset.value=0,a.start(),this._bendCS[n]=a,a}updateBend(n,a){this._bendCS||(this._bendCS=Object.create(null)),n=(n|0)&15;let t=this.getBendNode(n),i=Number.isFinite(a)?a:0;try{let r=this.actx.currentTime;t.offset.cancelScheduledValues(r),t.offset.setTargetAtTime(i,r,.01)}catch{t.offset.value=i}}setMidiSynth(n){this.midiSynth=n;let a=n&&(n.actx||n.audioContext);if(a&&a!==this.actx){try{this.masterGain?.disconnect()}catch{}this.actx=a,this.masterGain=this.actx.createGain(),this.masterGain.gain.value=.9,this.masterGain.connect(this.actx.destination),this.analyser=this.actx.createAnalyser(),this.analyser.fftSize=2048,this.mixers=Array.from({length:16},()=>{let t=this.actx.createGain();return t.gain.value=1,t}),console.log("[RC] adopted synth AudioContext and rebuilt mixers")}if(n?.chvol&&this.mixers)for(let t=0;t<16;t++)try{try{this.mixers[t].disconnect()}catch{}this.mixers[t].connect(n.chvol[t])}catch(i){console.warn(`[RC] mixer[ch${t}] -> chvol connect failed`,i)}}async resume(){this.actx.state!=="running"&&await this.actx.resume();try{this.midiSynth?.actx?.state!=="running"&&await this.midiSynth.actx.resume()}catch{}}build(n,a=0){this.liveNodes.clear();let t=h=>{let c=h.kind,e=h.params||{},p=this.actx;if(!h.enabled){let l=p.createGain();return{in:l,out:l}}switch(c){case"ks_source":{let l=p.createGain();return this.liveNodes.set(h.id+":ksOut",l),this.liveNodes.set(h.id+":ksParams",e),this.liveNodes.set("__lastKsId__",h.id),this.liveNodes.set("keyboardTarget",l),{in:l,out:l}}case"source":{let l=p.createOscillator();l.type=e.type||"sawtooth";let x=p.createGain();return x.gain.value=0,l.connect(x),l.start(),this.liveNodes.set(h.id+":osc",l),this.liveNodes.set(h.id+":env",x),this.liveNodes.set(h.id+":oscType",l.type),this.liveNodes.set(h.id+":ch",e.ch??"all"),this.liveNodes.set(h.id+":adsr",e.adsr||{a:.003,d:.08,s:.4,r:.2}),this.liveNodes.set("__oscType__",l.type),this.liveNodes.set("keyboardTarget",x),{in:x,out:x}}case"gain":{let l=this.actx.createGain();return l.gain.value=Number(e.gain??1),this.liveNodes.set(h.id+":node",l),{in:l,out:l}}case"filter":{let l=p.createBiquadFilter();return l.type=e.mode||"lowpass",l.frequency.value=Number(e.freq||1200),l.Q.value=Number(e.q||.7),this.liveNodes.set(h.id+":node",l),{in:l,out:l}}case"delay":{let l=p.createDelay(2);l.delayTime.value=Number(e.time||.25);let x=p.createGain();x.gain.value=Number(e.feedback||.3);let _=p.createGain();_.gain.value=Number(e.mix||.3);let M=p.createGain(),b=p.createGain(),m=p.createGain();return m.gain.value=1-_.gain.value,M.connect(l),M.connect(m),l.connect(x).connect(l),l.connect(_),m.connect(b),_.connect(b),this.liveNodes.set(h.id+":node",{input:M,output:b,delay:l,fb:x,mix:_}),{in:M,out:b}}case"analyzer":{let l=p.createGain();return l.connect(this.analyser),this.liveNodes.set(h.id+":node",l),{in:l,out:l}}default:{let l=p.createGain();return{in:l,out:l}}}},i=null,r=null;for(let h of n){let{in:c,out:e}=t(h);i||(i=c),r&&r.connect(c),r=e}i&&this.liveNodes.set("__chainHead__",i),r&&this.liveNodes.set("__chainTail__",r);try{if(!r)return;let h=a|0,c=this.actx.createGain();c.gain.value=1,this.liveNodes.set(`chainGain:${h}`,c),r.connect(c);let p=n.find(x=>x.kind==="ks_source"||x.kind==="source")?.params?.ch??"all",l=p==="all"?Array.from({length:16},(x,_)=>_):[Number(p)];for(let x of l){let _=this.mixers[x];_&&c.connect(_)}}catch(h){console.warn("[RC] mixer connect failed",h)}}buildMany(n){let a=this.liveNodes,t=a.get("__oscVoices__"),i=a.get("__ksVoices__"),r=new Map;n.forEach((h,c)=>{let e=new Map;this.liveNodes=e,this.build(h,c);for(let[p,l]of e.entries())r.set(p,l)}),t&&r.set("__oscVoices__",t),i&&r.set("__ksVoices__",i),this.liveNodes=r}setChainMute(n,a){try{let t=`chainGain:${n|0}`,i=this.liveNodes&&this.liveNodes.get(t);if(!i||!i.gain)return console.warn("[RC] setChainMute: chainGain not found",t),!1;let r=this.actx.currentTime;return i.gain.cancelScheduledValues(r),i.gain.setValueAtTime(a?0:1,r),console.log("[RC] setChainMute",{chainIdx:n,key:t,muted:a,gain:i.gain.value}),!0}catch(t){return console.warn("[RC] setChainMute failed",n,t),!1}}gate(n,a=.8,t=0,i=69){let r=this.actx.currentTime,h=(i??69)|0,c=!1;if(n){let e=this.pluckKS(t,i??69,a)===!0,p=this.gateOsc(t,i,a)===!0;c=e||p}if(n&&!c){let p=(this.midiSynth&&typeof this.midiSynth.a4_freq=="number"?this.midiSynth.a4_freq:440)*Math.pow(2,(h-69)/12),l=[];for(let[G,V]of this.liveNodes.entries())if(G.endsWith(":oscType")){let q=G.split(":")[0],$=this.liveNodes.get(q+":ch")??"all",I=this.liveNodes.get(q+":adsr")||{a:.003,d:.08,s:.4,r:.2},j=V||"sawtooth";($==="all"||Number($)===t)&&l.push({modId:q,type:j,adsr:I})}if(!l.length)return;let x=this.liveNodes.get("__chainTail__"),_=this.liveNodes.get("__chainHead__"),M=this.liveNodes.get("keyboardTarget"),b=this.midiSynth?.chvol?.[t];this.liveNodes.has("__oscVoices__")||this.liveNodes.set("__oscVoices__",{});let m=this.liveNodes.get("__oscVoices__");m[t]||(m[t]={});for(let G of l){let V=this.actx.createOscillator();try{V.type=G.type}catch{V.type="sawtooth"}V.frequency.setValueAtTime(p,r);try{let J=this.midiSynth?.chmod?.[t];J&&V.detune&&J.connect(V.detune);let L=this.getBendNode(t);V.detune&&L&&L.connect(V.detune),typeof this.midiSynth?.bend?.[t]=="number"&&this.updateBend(t,this.midiSynth.bend[t])}catch(J){console.warn("[RC] osc detune connect failed",J)}let q=this.actx.createGain();q.gain.setValueAtTime(0,r);let{a:$,d:I,s:j,r:ae}=G.adsr;q.gain.linearRampToValueAtTime(a,r+($??.003)),q.gain.linearRampToValueAtTime((j??.4)*a,r+($??.003)+(I??.08)),V.connect(q);let B=null;_&&_!==M?B=_:x?B=x:b&&(B=b),!B&&b&&(B=b),B&&q.connect(B),V.start(r);let Z=`${h}_${performance.now().toFixed(1)}_${Math.random().toString(36).slice(2,5)}`;m[t][Z]={note:h,osc:V,env:q,r:ae??.2}}}if(!n){let e=this.actx.currentTime,p=this.liveNodes.get("__ksVoices__"),l=(this.midiSynth?.pedal?.[t]??0)>=64;if(p&&p[t]){let M=Object.entries(p[t]).filter(([b,m])=>m.note===h);for(let[b,m]of M){let{bfs:G,env:V}=m;if(l){m.sustained=!0;continue}try{let q=Number(m.params?.ksRelease??.5),$=.02,j=$+(1.5-$)*Math.pow(q,2);V.gain.cancelScheduledValues(e),V.gain.setValueAtTime(V.gain.value??1,e),V.gain.linearRampToValueAtTime(0,e+j),G.stop(e+j+.05),setTimeout(()=>{try{G.disconnect(),V.disconnect()}catch{}delete p[t][b]},(j+.05)*1e3)}catch{delete p[t][b]}}}let x=this.liveNodes.get("__oscVoices__");if(!x||!x[t])return;let _=Object.entries(x[t]).filter(([M,b])=>b.note===h);for(let[M,b]of _){let{osc:m,env:G,r:V=.2}=b;try{G.gain.cancelScheduledValues(e),G.gain.setValueAtTime(G.gain.value??0,e),G.gain.linearRampToValueAtTime(0,e+V),m.stop(e+V+.05),setTimeout(()=>{try{m.disconnect(),G.disconnect()}catch{}delete x[t][M]},(V+.1)*1e3)}catch{delete x[t][M]}}}}pluckKS(n,a,t){let i=Array.from(this.liveNodes.entries()).filter(([g])=>g.endsWith(":ksOut"));if(!i.length)return!1;let r=null,h={},c=[],e=Number(this.midiSynth&&this.midiSynth.pg?this.midiSynth.pg[n]:0);for(let[g,S]of i){let E=this.liveNodes.get(g.replace(":ksOut",":ksParams"))||{},o=E.ch!=null?String(E.ch):"all",s=o==="all"||Number(o)===n,d=E.program;(d==null||d==="all")&&(d="all");let N=d==="all"?null:Number(d);s&&(N===null||N===e)&&(r||(r=[g,S],h=E),c.push(S))}if(!r)return console.warn("[RC] no ks_source matches ch/pg",{ch:n,curPg:e}),!1;let p=r[0],l=r[1],x=h,M=(this.midiSynth&&typeof this.midiSynth.a4_freq=="number"?this.midiSynth.a4_freq:440)*Math.pow(2,(a-69)/12),b=this.actx.sampleRate,m=null;try{let g=String(x.seedNoiseType??"pink"),S=Math.max(2048,Math.round(b/Math.max(1e-6,M))),E=f=>{let C=new Float32Array(f);for(let v=0;v<f;v++)C[v]=Math.random()*2-1;return C},o=f=>{let C=new Float32Array(f),v=0,w=0,y=0,T=0,A=0,H=0,ee=0;for(let ie=0;ie<f;ie++){let X=Math.random()*2-1;v=.99886*v+X*.0555179,w=.99332*w+X*.0750759,y=.969*y+X*.153852,T=.8665*T+X*.3104856,A=.55*A+X*.5329522,H=-.7616*H-X*.016898,C[ie]=(v+w+y+T+A+H+ee*.5362)*.11,ee=X*.115926}return C},s=f=>{let C=new Float32Array(f),v=0;for(let w=0;w<f;w++)v+=Math.random()*2-1,v=Math.max(-8,Math.min(8,v)),C[w]=v/8;return C},d=f=>{let C=E(f),v=o(f),w=new Float32Array(f);for(let y=0;y<f;y++)w[y]=.6*C[y]+.4*v[y];return w},N=f=>{let C=new Float32Array(f),v=0,w=0;for(let y=0;y<f;y++)v+=(Math.random()*2-1)*.02,w+=v,C[y]=w*5e-4;return C},R=f=>{let C=new Float32Array(f),v=0;for(let T=0;T<f;T++){let A=Math.random()*2-1;C[T]=A-v,v=A}let w=new Float32Array(f),y=0;for(let T=0;T<f;T++)y=y*.992+C[T]*.008,w[T]=y;return w},D=f=>{let C=new Float32Array(f),v=0;for(let T=0;T<f;T++){let A=Math.random()*2-1;C[T]=A-v,v=A}let w=new Float32Array(f),y=0;for(let T=0;T<f;T++)y=y*.995+C[T]*.005,w[T]=y;return w},se=f=>{let C=s(f),v=new Float32Array(f),w=0;for(let y=0;y<f;y++)w=w*.995+C[y]*.005,v[y]=w*.9;return v},Q=f=>{let C=o(f),v=new Float32Array(f),w=0;for(let y=0;y<f;y++)w=w*.993+C[y]*.007,v[y]=w*.9;return v},we=f=>{let C=new Float32Array(f),v=0,w=0;for(let y=0;y<f;y++){let T=Math.random()*2-1;v=v*.985+T*.015,w=w*.995+(Math.random()*2-1)*.005;let A=.6+.4*w;C[y]=v*A}return C},ke=f=>{let C=new Float32Array(f),v=Math.max(8,Math.floor(f/64)),w=[],y=Math.floor(f/v)+2;for(let A=0;A<y;A++)w[A]=Math.random()*2-1;let T=A=>A*A*A*(A*(A*6-15)+10);for(let A=0;A<f;A++){let H=A/v,ee=Math.floor(H),ie=H-ee,X=w[ee],Me=w[ee+1],fe=T(ie);C[A]=(X*(1-fe)+Me*fe)*.9}return C},_e=f=>{let C=new Float32Array(f),v=E(f),w=300,y=800,T=2500;for(let A=0;A<f;A++){let H=A/b,ee=1+.6*Math.sin(2*Math.PI*w*H)+.4*Math.sin(2*Math.PI*y*H+1.3)+.25*Math.sin(2*Math.PI*T*H+.7);C[A]=v[A]*(ee*.25)}return C},Ce=f=>{let C=new Float32Array(f),v=0,w=.004;for(let y=0;y<f;y++)Math.random()<w&&(v+=(Math.random()*2-1)*.9),v*=.96,C[y]=v;return C},Se=f=>{let C=Q(f),v=new Float32Array(f),w=220,y=550;for(let T=0;T<f;T++){let A=T/b,H=.5*Math.sin(2*Math.PI*w*A)+.35*Math.sin(2*Math.PI*y*A+1.1);v[T]=C[T]*(1+.4*H)}return v};switch(g){case"white":m=E(S);break;case"pink":m=o(S);break;case"brown":m=s(S);break;case"softBrown":m=se(S);break;case"softPink":m=Q(S);break;case"red":m=N(S);break;case"blue":m=R(S);break;case"violet":m=D(S);break;case"gray":m=d(S);break;case"wind":m=we(S);break;case"perlin":m=ke(S);break;case"formant":m=_e(S);break;case"dust":m=Ce(S);break;case"wood":m=Se(S);break;default:m=o(S);break}}catch(g){console.warn("[RC] seed generation failed, fallback pink",g);let S=2048;m=new Float32Array(S);for(let E=0;E<S;E++)m[E]=Math.random()*2-1}if(console.log("[RC] seed check",m?.length,m?.[0]),!m||!m.length){console.warn("[RC] seed invalid, injecting pink noise");let g=Math.max(2048,Math.round(b/Math.max(1e-6,M)));m=new Float32Array(g);for(let S=0;S<g;S++)m[S]=Math.random()*2-1}let G=Number(x.ksDurSec);Number.isFinite(G)||(G=1),G=Math.min(Math.max(G,.1),10);let V=Math.round(b*G),q=this.actx.createBuffer(2,V,b),$=String(x.smoothingMode??"auto"),I=this.midiSynth?.options?.[n]??{},j;if($==="manual"){let g=Number(x.smoothingFactor);Number.isFinite(g)||(g=.2),g<.01&&(g=.01),g>.99&&(g=.99),j=g}else try{let g=this.midiSynth?.inv127??.007874015748031496,S=Math.pow(a/64,.5)||0,E=a*g*.85+.15;typeof I.stringDamping=="number"?E=I.stringDamping:this.midiSynth?.options?.[n]&&(this.midiSynth.options[n].stringDamping=E);let o=Number(I.stringDampingVariation??0);j=E+S*(1-E)*.5+(1-E)*Math.random()*o}catch{j=.2}Number.isFinite(j)||(j=.2);let ae=Number(x.velScale==null?1:x.velScale);if(Object.keys(I).length===0&&(I.stringDamping=.5,I.stringDampingVariation=.2),Number.isFinite(j)||(j=.2),!m||!m.length){console.warn("[RC] seed invalid, injecting pink noise");let g=Math.max(2048,Math.round(b/Math.max(1e-6,M)));m=new Float32Array(g);for(let S=0;S<g;S++)m[S]=Math.random()*2-1}try{let g=this.midiSynth?.asmWrapper?.[n];g&&typeof g.pluck=="function"&&g.pluck(q,m,b,M,j,t*ae,I,.2)}catch(g){console.warn("[RC] pluck error",g)}let B=this.actx.createBufferSource();B.buffer=q;try{let g=this.midiSynth?.chmod?.[n];g&&B.detune&&g.connect(B.detune)}catch{}try{let g=this.midiSynth?.bend?.[n];typeof g=="number"&&B.detune&&(B.detune.value=g)}catch{}let Z=this.actx.createGain();Z.gain.setValueAtTime(1,this.actx.currentTime),this.liveNodes.has("__ksVoices__")||this.liveNodes.set("__ksVoices__",{});let J=this.liveNodes.get("__ksVoices__");J[n]||(J[n]={});let L=`${a}_${performance.now().toFixed(1)}_${Math.random().toString(36).slice(2,5)}`;J[n][L]={note:a,bfs:B,env:Z,params:x,sustained:!1},B.addEventListener("ended",()=>{try{this.midiSynth?.bfSet?.[n]?.[a]===B&&(this.midiSynth.bfSet[n][a]=null)}catch{}try{let g=this.liveNodes.get("__ksVoices__");g&&g[n]&&g[n][L]&&delete g[n][L]}catch{}});try{this.midiSynth.bfSet||(this.midiSynth.bfSet={}),this.midiSynth.bfSet[n]||(this.midiSynth.bfSet[n]={}),this.midiSynth.bfSet[n][a]=B}catch{}try{let g=p.replace(":ksOut",":tail"),S=this.liveNodes.get(g)||this.liveNodes.get("__chainTail__")}catch{}B.connect(Z);for(let g of c)try{Z.connect(g)}catch(S){console.warn("[RC] env.connect ksOut failed",S)}return B.start(),!0}gateOsc(n,a,t){let i=Array.from(this.liveNodes.entries()).filter(([l])=>l.endsWith(":osc"));if(!i.length)return!1;let r=!1,h=(a??69)|0,c=this.actx.currentTime,p=(this.midiSynth&&typeof this.midiSynth.a4_freq=="number"?this.midiSynth.a4_freq:440)*Math.pow(2,(h-69)/12);for(let[l,x]of i){let _=l.replace(":osc",""),M=this.liveNodes.get(_+":ch")??"all";if(!(M==="all"||Number(M)===n))continue;let m=this.liveNodes.get(_+":env"),G=this.liveNodes.get(_+":adsr")||{a:.003,d:.08,s:.4,r:.2};if(!m)continue;try{x.frequency.setValueAtTime(p,c)}catch{}let{a:V,d:q,s:$,r:I}=G;m.gain.cancelScheduledValues(c),m.gain.setValueAtTime(0,c),m.gain.linearRampToValueAtTime(t,c+(V??.003)),m.gain.linearRampToValueAtTime(($??.4)*t,c+(V??.003)+(q??.08)),m.gain.linearRampToValueAtTime(0,c+(V??.003)+(q??.08)+(I??.2)),r=!0}return r}releaseSustainKSForChannel(n){let a=this.actx.currentTime,t=this.liveNodes.get("__ksVoices__");if(!(!t||!t[n]))for(let[i,r]of Object.entries(t[n])){if(!r.sustained)continue;let{bfs:h,env:c,params:e}=r,p=Number(e?.ksRelease??.5),l=.02,_=l+(1.5-l)*Math.pow(p,2);c.gain.cancelScheduledValues(a),c.gain.setValueAtTime(c.gain.value??1,a),c.gain.linearRampToValueAtTime(0,a+_),h.stop(a+_+.05),r.sustained=!1,setTimeout(()=>{try{h.disconnect(),c.disconnect()}catch{}delete t[n][i]},(_+.05)*1e3)}}};import{Fragment as xe,jsx as O,jsxs as K}from"react/jsx-runtime";var W="px-3 py-1 rounded-xl border border-white/10 shadow hover:bg-white/5 active:scale-[.98] transition";var De=["ks_source","source","filter","delay","reverb","convolver_ir","gain","analyzer"],oe={ks_source:{smoothingMode:"auto",smoothingFactor:.2,velScale:1,seedNoiseType:"pink",useSynthA4:!0,ch:"all",program:"all"},source:{type:"sawtooth",ch:"all",adsr:{a:.003,d:.08,s:.4,r:.2}},filter:{mode:"lowpass",freq:1200,q:.7},delay:{time:.25,feedback:.35,mix:.3},reverb:{decay:2,mix:.25},convolver_ir:{irId:"IR_Gibson",mix:.3},gain:{gain:.8},analyzer:{}};function P(k="m"){return`${k}_${Math.random().toString(36).slice(2,9)}`}function ye(k,n,a){let t=k.slice(),i=Math.max(0,Math.min(t.length-1,n)),r=t.splice(i,1)[0],h=Math.max(0,Math.min(t.length,a));return t.splice(h,0,r),t}function me({synth:k}){let n=ve(null);n.current||(n.current=new ce);let a=n.current;te(()=>{if(k&&typeof a.setMidiSynth=="function")try{a.setMidiSynth(k),console.log("[RC] midi_synth attached to engine")}catch(o){console.warn("[RC] setMidiSynth failed",o)}},[k]),te(()=>(window.__RC_HANDLE__={midi:o=>{try{a.handleMIDIMsg&&a.handleMIDIMsg(o),console.log("[RC] MIDI -> engine",o)}catch(s){console.warn("[RC] MIDI ingress failed",s)}},engine:a},()=>{try{delete window.__RC_HANDLE__}catch{}}),[a]);let[t,i]=le([[{id:P("ks"),kind:"ks_source",enabled:!0,params:{...oe.ks_source}},{id:P("gain"),kind:"gain",enabled:!0,params:{...oe.gain}},{id:P("an"),kind:"analyzer",enabled:!0,params:{}}]]),[r,h]=le([]),c=ve(r);te(()=>{c.current=r},[r]),te(()=>{h(o=>{let s=o.slice(0,t.length);for(;s.length<t.length;)s.push(!1);return s})},[t.length]);let e=o=>{h(s=>{let d=[...s];return d[o]=!d[o],d})},[p,l]=le({open:!1,idx:null,step:1}),x=o=>l({open:!0,idx:o,step:1}),_=()=>l({open:!1,idx:null,step:1}),M=()=>l(o=>({...o,step:2})),b=()=>{i(o=>{let s=o.filter((d,N)=>N!==p.idx);return s.length?s:[[{id:P("src"),kind:"source",enabled:!0,params:{...oe.source}},{id:P("gain"),kind:"gain",enabled:!0,params:{...oe.gain}},{id:P("an"),kind:"analyzer",enabled:!0,params:{}}]]}),_()};te(()=>{try{a.buildMany(t),a.resume&&a.resume(),c.current.forEach((o,s)=>{typeof a.setChainMute=="function"&&a.setChainMute(s,o)})}catch(o){console.warn("[RC] buildMany failed",o)}},[a,JSON.stringify(t)]),te(()=>{r.forEach((o,s)=>{typeof a.setChainMute=="function"&&a.setChainMute(s,o)})},[a,r]),te(()=>{navigator.requestMIDIAccess&&navigator.requestMIDIAccess().then(o=>{for(let s of o.inputs.values())s.onmidimessage=d=>a.handleMIDIMsg(d.data)})},[]);let m=(o,s)=>i(d=>{let N=d.map(R=>[...R]);return N[o]=[...N[o],{id:P(s),kind:s,enabled:!0,params:{...oe[s]}}],N}),G=(o,s)=>i(d=>d.map((N,R)=>R!==o?N:N.map(D=>D.id===s?{...D,enabled:!D.enabled}:D))),V=(o,s)=>i(d=>d.map((N,R)=>R!==o?N:N.filter(D=>D.id!==s))),q=(o,s,d,N)=>{d==="gain"&&(a.updateGainNodeById(s,N)||console.warn("[RC] gain node not found for id:",s)),i(R=>R.map((D,se)=>se!==o?D:D.map(Q=>Q.id===s?{...Q,params:{...Q.params,[d]:N}}:Q)))},[$,I]=le(null),j=(o,s)=>d=>{I({chain:o,from:s}),d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("text/plain",`${o}:${s}`)},ae=(o,s)=>d=>{d.preventDefault(),!(!$||$.chain!==o)&&(i(N=>N.map((R,D)=>D!==o?R:ye(R,$.from,s))),I(null))},B=o=>s=>{s.preventDefault(),!(!$||$.chain!==o)&&(i(d=>d.map((N,R)=>R!==o?N:ye(N,$.from,N.length))),I(null))},Z=o=>i(s=>{let d=s.map(R=>[...R]),N=d[o].map(R=>({...R,id:P(R.kind)}));return d.splice(o+1,0,N),d}),J=o=>{let s=t[o];if(!s)return;let d=s,N=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),R=URL.createObjectURL(N),D=document.createElement("a");D.href=R,D.download=`audio-chain-${o+1}.json`,D.click(),URL.revokeObjectURL(R)},L=async(o,s)=>{let d=await s.text();try{let N=JSON.parse(d);if(!Array.isArray(N))return;let R=N.map(D=>({id:P(D.kind||"mod"),kind:D.kind||"gain",enabled:D.enabled!==!1,params:D.params||{}}));i(D=>D.map((se,Q)=>Q===o?R:se))}catch(N){console.warn("[RC] importChain failed",N)}},g=()=>i(o=>[...o,[]]),S=()=>{let o=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),s=URL.createObjectURL(o),d=document.createElement("a");d.href=s,d.download="audio-chains.json",d.click(),URL.revokeObjectURL(s)},E=async o=>{let s=await o.text();try{let d=JSON.parse(s);Array.isArray(d)&&Array.isArray(d[0])&&i(d)}catch(d){console.warn("Invalid chain JSON",d)}};return K("div",{className:"p-6 text-white",children:[O("div",{className:"flex items-center justify-between mb-4",children:K("div",{className:"flex items-center gap-2 flex-wrap",children:[O("button",{className:W,onClick:S,children:"Export"}),K("label",{className:`${W} cursor-pointer`,children:["Import",O("input",{type:"file",accept:"application/json",className:"hidden",onChange:o=>{let s=o.target.files?.[0];s&&E(s)}})]}),O("button",{className:W,onClick:()=>{typeof a.buildMultiFrom=="function"?a.buildMultiFrom(t[0],Array.from({length:16},(o,s)=>s)):i(o=>{let s=o[0]||[];return Array.from({length:16},(N,R)=>s.map(D=>({...D,id:P(D.kind)+`_ch${R}`,params:D.kind==="ks_source"?{...D.params,ch:String(R)}:{...D.params}})))})},children:"Duplicate to 16 channels"})]})}),K("div",{className:"relative border border-dashed border-white/20 rounded-2xl p-4 overflow-x-auto",children:[t.map((o,s)=>K("div",{className:"mb-6",children:[K("div",{className:"flex items-center justify-between mb-2",children:[K("div",{className:"text-sm opacity-80",children:["Chain #",s+1]}),K("div",{className:"flex gap-2 items-center",children:[O("button",{className:W,onClick:()=>e(s),title:r[s]?"Unmute chain":"Mute chain",children:r[s]?"\u{1F507}":"\u{1F50A}"}),O("button",{className:W,onClick:()=>J(s),children:"Export"}),K("label",{className:`${W} cursor-pointer`,children:["Import",O("input",{type:"file",accept:"application/json",className:"hidden",onChange:d=>{let N=d.target.files?.[0];N&&L(s,N),d.target.value=""}})]}),O("button",{className:W,onClick:()=>Z(s),children:"Duplicate"}),O("button",{className:W,onClick:()=>x(s),children:"Delete"})]})]}),K("div",{className:"flex gap-3 items-stretch",children:[o.map((d,N)=>O("div",{onDrop:ae(s,N),onDragOver:R=>R.preventDefault(),className:"hover:border-white/20 transition border border-transparent rounded-2xl",title:"Drag to reorder",children:O(ue,{mod:d,onToggle:()=>G(s,d.id),onRemove:()=>V(s,d.id),onParam:(R,D)=>q(s,d.id,R,D),onDragStart:j(s,N)})},d.id)),O("div",{className:"w-12 rounded-xl border-2 border-dashed border-white/10 hover:border-white/20 flex items-center justify-center opacity-60",onDragOver:d=>d.preventDefault(),onDrop:B(s),children:"\u2192"})]}),O("div",{className:"mt-3 flex flex-wrap gap-2",children:De.map(d=>K("button",{className:W,onClick:()=>m(s,d),children:["+ ",d]},`${s}-${d}`))})]},s)),O("div",{className:"mt-2 flex justify-center",children:O("button",{className:W,onClick:g,children:"+ Add chain"})})]}),p.open&&O("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",children:O("div",{className:"bg-neutral-900 border border-white/10 rounded-2xl p-5 w-[420px] shadow-xl",children:p.step===1?K(xe,{children:[O("div",{className:"text-lg font-semibold mb-2",children:"Delete this chain?"}),O("p",{className:"text-sm opacity-80 mb-4",children:"Confirm to continue."}),K("div",{className:"flex justify-end gap-2",children:[O("button",{className:W,onClick:_,children:"Cancel"}),O("button",{className:W,onClick:M,children:"Next"})]})]}):K(xe,{children:[O("div",{className:"text-lg font-semibold mb-2",children:"Are you sure?"}),O("p",{className:"text-sm opacity-80 mb-4",children:"This cannot be undone."}),K("div",{className:"flex justify-end gap-2",children:[O("button",{className:W,onClick:_,children:"Cancel"}),O("button",{className:W,onClick:b,children:"Delete"})]})]})})})]})}import{jsx as U,jsxs as Y}from"react/jsx-runtime";function re({synth:k,buttonTarget:n,autoTailwind:a=!1}){let[t,i]=he(!1);de(()=>{if(!t)return;(async()=>{try{await __RC_HANDLE__?.engine?.resume?.(),window.synth?.actx?.state==="suspended"&&await window.synth.actx.resume()}catch(b){console.warn("[RC] resumeAll failed",b)}})()},[t]);let[r,h]=he(.3),[c,e]=he(()=>k?.a4_freq??440);de(()=>{typeof k?.a4_freq=="number"&&e(Number(k.a4_freq))},[k]),de(()=>{let M=c,b=setInterval(()=>{let m=Number(k?.a4_freq??440);!Number.isNaN(m)&&m!==M&&(M=m,e(m))},250);return()=>clearInterval(b)},[k,c]);let p=420,x=Math.max(0,Math.min(1,(c-p)/(460-p)))*100;de(()=>{if(!a||!!document.querySelector("script[data-rc-tailwind]")||!!document.querySelector('script[src*="tailwindcss"]'))return;let b=document.createElement("script");b.src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4",b.dataset.rcTailwind="1",document.head.appendChild(b)},[a]);let _=()=>U("button",{className:"rc-toggle-btn",onClick:async()=>{requestAnimationFrame(()=>i(!0));try{await __RC_HANDLE__?.engine?.resume?.(),window.synth?.actx?.state==="suspended"&&await window.synth.actx.resume()}catch{}},title:"Open Routing Composer",children:"Routing Composer"});return Y("div",{children:[U("style",{children:`
        :root { --rc-bg1:#0f1022; --rc-bg2:#2a2b55; --rc-card:rgba(22,22,34,.92); --rc-border:rgba(255,255,255,.1); --rc-text:#f5f7ff; }
        /* \u9810\u8A2D\u6DFA\u8272\u6A21\u5F0F \u2192 \u6DF1\u5929\u7A7A\u85CD */
        :root {
          --rc-toggle-text: #38bdf8; /* sky-400 */
        }

        /* \u6DF1\u8272\u6A21\u5F0F \u2192 \u6DFA\u5929\u7A7A\u85CD */
        @media (prefers-color-scheme: dark) {
          :root {
            --rc-toggle-text: #7dd3fc; /* sky-300 */
          }
        }
        /* \u5957\u5230\u6253\u958B GUI \u7684\u6309\u9215 */
        .rc-toggle-btn {
          color: var(--rc-toggle-text) !important;
        }
        .rc-toggle-btn { padding:10px 14px; border-radius:999px; border:1px solid var(--rc-border); background:rgba(255,255,255,.08); color:var(--rc-text); /*backdrop-filter:blur(8px);*/ box-shadow:0 6px 24px rgba(0,0,0,.35); cursor:pointer; z-index:9999; }
        .rc-toggle-btn:hover { background:rgba(255,255,255,.12); }
        .rc-overlay { position:fixed; inset:0; background:rgba(0,0,0,.45); /*backdrop-filter:blur(2px);*/ display:flex; align-items:center; justify-content:center; z-index:9998; }
        .rc-panel { width:min(1120px,96vw); height:min(88vh,900px); background:var(--rc-card); border:1px solid var(--rc-border); border-radius:18px; box-shadow:0 20px 60px rgba(0,0,0,.5); color:var(--rc-text); display:flex; flex-direction:column; overflow:hidden; }
        .rc-header { display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid var(--rc-border); font-weight:700; letter-spacing:.2px; }
        .rc-close { padding:8px 12px; border-radius:10px; border:1px solid var(--rc-border); background:rgba(255,255,255,.06); color:var(--rc-text); cursor:pointer; }
        .rc-close:hover { background:rgba(255,255,255,.1); }
        .rc-body { flex:1; overflow:auto; padding:8px 10px; }
        .rc-fixed-default { position:fixed; top:12px; left:12px; }
        /* === Gradient progress slider (cross-browser) === */
        .rc-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 5px;
            /* \u5169\u5C64\u80CC\u666F\uFF1A\u524D\u666F=\u6F38\u5C64(\u53EA\u756B\u5230 --rc-pos)\uFF0C\u5E95\u5C64=\u672A\u586B\u7070 */
            background:
                linear-gradient(15deg,
                hsla(275, 70%, 35%, 1) 20%,
                hsla(280, 70%, 60%, 1) 50%,
                hsla(285, 70%, 80%, 1) 80%) 0% 0% / var(--rc-pos, 0%) 100% no-repeat,
                rgba(255,255,255,0.12);
            outline: none;
            transition: filter .2s ease;
        }
        .rc-slider:active { filter: brightness(1.1); }

        /* Chrome / Edge \u8ECC\u9053 */
        .rc-slider::-webkit-slider-runnable-track {
            height: 6px;
            background: transparent; /* \u8B93\u4E0A\u9762 .rc-slider \u7684\u591A\u91CD\u80CC\u666F\u751F\u6548 */
            border-radius: 5px;
        }

        /* Chrome / Edge \u62C7\u6307 */
        .rc-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fff 10%, hsla(285, 80%, 75%, 1) 60%);
            box-shadow: 0 0 4px rgba(255,255,255,0.5);
            cursor: pointer;
            margin-top: -4px; /* \u8B93\u62C7\u6307\u5782\u76F4\u7F6E\u4E2D\u8ECC\u9053\uFF08\u4F9D\u700F\u89BD\u5668\u53EF\u5FAE\u8ABF\uFF09 */
        }

        /* Firefox \u8ECC\u9053\uFF08\u672A\u586B\uFF09 */
        .rc-slider::-moz-range-track {
            height: 6px;
            background: rgba(255,255,255,0.12);
            border: none;
            border-radius: 5px;
        }

        /* Firefox \u5DF2\u586B\u90E8\u5206\uFF08\u756B\u6F38\u5C64\uFF09 */
        .rc-slider::-moz-range-progress {
            height: 6px;
            background: linear-gradient(15deg,
                hsla(275, 70%, 35%, 1) 20%,
                hsla(280, 70%, 60%, 1) 50%,
                hsla(285, 70%, 80%, 1) 80%);
            border-radius: 5px 0 0 5px;
        }

        /* Firefox \u62C7\u6307 */
        .rc-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border: none;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fff 10%, hsla(285, 80%, 75%, 1) 60%);
            box-shadow: 0 0 4px rgba(255,255,255,0.5);
            cursor: pointer;
        }
        .rc-overlay::before {
          content: "";
          position: absolute;
          inset: 0;
          background: linear-gradient(135deg,#0b0d1f99,#272b5277);
          opacity: .9;
          pointer-events: none;
        }
        input[type=range] { accent-color: #3b82f6; }
      `}),n?Ve.createPortal(U(_,{}),n):U("div",{className:"rc-fixed-default",children:U(_,{})}),U("div",{className:"rc-overlay",style:{display:t?"flex":"none"},onClick:M=>{M.target===M.currentTarget&&i(!1)},children:Y("div",{className:"rc-panel",role:"dialog","aria-modal":"true",children:[Y("div",{className:"rc-header",children:[Y("div",{className:"flex items-center gap-4",children:[U("div",{children:"Routing Composer"}),Y("div",{className:"flex items-center gap-2 text-sm opacity-90",children:[U("span",{children:"A4"}),U("input",{type:"range",min:"420",max:"460",step:"0.1",value:c,className:"rc-slider",style:{"--rc-pos":`${(c-420)/40*100}%`,width:160},onChange:M=>{let b=Number(M.target.value);Number.isNaN(b)||(e(b),k&&(k.a4_freq=b))}}),Y("span",{children:[c.toFixed(1),"Hz"]})]}),Y("div",{className:"flex items-center gap-2 text-sm opacity-90",children:[U("span",{children:"Vol"}),U("input",{type:"range",min:"0",max:"1",step:"0.01",value:r,className:"rc-slider",style:{"--rc-pos":`${r*100}%`,width:160},onChange:M=>{let b=Number(M.target.value);Number.isNaN(b)||(h(b),midi_synth&&midi_synth.setMasterVol(b))}}),Y("span",{children:[(r*100).toFixed(0),"%"]})]})]}),Y("div",{className:"flex items-center gap-2",children:[U("button",{className:"rc-close",onClick:()=>k?.actx?.resume?.(),children:"Resume Audio"}),U("button",{className:"rc-close",onClick:()=>i(!1),children:"Close"})]})]}),U("div",{className:"rc-body",children:U(me,{synth:k})})]})})]})}import{jsx as Ne}from"react/jsx-runtime";var at=re;(function(){if(typeof window>"u")return;let n={mount(a={}){let{synth:t,button:i,tailwind:r="auto"}=a,h=null;i&&(typeof i=="string"?h=document.querySelector(i):i instanceof HTMLElement&&(h=i));let c=document.createElement("div");return document.body.appendChild(c),pe.createRoot?pe.createRoot(c).render(Ne(re,{synth:t,buttonTarget:h,autoTailwind:r==="auto"})):pe.render(Ne(re,{synth:t,buttonTarget:h,autoTailwind:r==="auto"}),c),console.log("[RoutingComposer] mounted GUI"),{host:c}}};window.RoutingComposer=n})();export{at as default};
