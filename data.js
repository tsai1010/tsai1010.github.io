let inputPort = 'loopMIDI Port'
let outputPort = 'test'

let allPort = true;
let totalAudioValue = 0.15;
let harmonic = 9;

let osc_easing = 0.0001;
let osc_attack = 0.02;
let osc_decay = 14.5;
let osc_release = 2.0;

let A4_freq = 440.0;

let menuBtn_click = false; //menu btn
let playInput = false; //Audio btn
let opMidi = false;

let cfShow = false;

let op //output obj

var midiPlayer

const menuBarColor = "#AAAAFF"

WkeyColor = [
    "linear-gradient(15deg, hsla(275, 70%, 35%, 1) 20%, hsla(280, 70%, 60%, 1) 50%, hsla(285, 70%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(220, 70%, 35%, 1) 20%, hsla(205, 70%, 60%, 1) 50%, hsla(190, 70%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(175, 70%, 30%, 1) 20%, hsla(165, 70%, 60%, 1) 50%, hsla(155, 70%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(315, 70%, 35%, 1) 20%, hsla(325, 70%, 60%, 1) 50%, hsla(335, 70%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(190, 60%, 35%, 1) 20%, hsla(190, 60%, 60%, 1) 50%, hsla(190, 60%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(60, 70%, 35%, 1) 20%, hsla(65, 70%, 60%, 1) 50%, hsla(70, 70%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(100, 70%, 35%, 1) 20%, hsla(110, 70%, 60%, 1) 50%, hsla(120, 70%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(350, 70%, 35%, 1) 20%, hsla(355, 70%, 60%, 1) 50%, hsla(360, 70%, 80%, 1) 80%)",
    //----------------------------//
    "linear-gradient(15deg, hsla(260, 60%, 35%, 1) 20%, hsla(260, 60%, 60%, 1) 50%, hsla(260, 60%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(15, 70%, 35%, 1) 20%, hsla(35, 70%, 60%, 1) 50%, hsla(50, 70%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(135, 60%, 30%, 1) 20%, hsla(135, 60%, 60%, 1) 50%, hsla(135, 60%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(300, 60%, 35%, 1) 20%, hsla(300, 60%, 60%, 1) 50%, hsla(300, 60%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(10, 60%, 35%, 1) 20%, hsla(10, 60%, 60%, 1) 50%, hsla(10, 60%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(85, 60%, 30%, 1) 20%, hsla(85, 60%, 60%, 1) 50%, hsla(85, 60%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(240, 60%, 35%, 1) 20%, hsla(240, 60%, 60%, 1) 50%, hsla(240, 60%, 80%, 1) 80%)",
    "linear-gradient(15deg, hsla(342, 60%, 35%, 1) 20%, hsla(342, 60%, 60%, 1) 50%, hsla(342, 60%, 80%, 1) 80%)"
]

BkeyColor = [
    "linear-gradient(15deg, hsla(275, 70%, 30%, 1) 60%, hsla(280, 70%, 60%, 1) 90%, hsla(285, 70%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(220, 70%, 35%, 1) 60%, hsla(205, 70%, 60%, 1) 90%, hsla(190, 70%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(175, 70%, 27%, 1) 60%, hsla(165, 70%, 60%, 1) 90%, hsla(155, 70%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(315, 70%, 30%, 1) 60%, hsla(325, 70%, 60%, 1) 90%, hsla(335, 70%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(190, 60%, 30%, 1) 60%, hsla(190, 60%, 60%, 1) 90%, hsla(190, 60%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(60, 70%, 30%, 1) 60%, hsla(65, 70%, 60%, 1) 90%, hsla(70, 70%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(100, 70%, 30%, 1) 60%, hsla(110, 70%, 60%, 1) 90%, hsla(120, 70%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(350, 70%, 32%, 1) 60%, hsla(355, 70%, 60%, 1) 90%, hsla(360, 70%, 80%, 1) 100%)",
    //---------------------------//
    "linear-gradient(15deg, hsla(260, 70%, 30%, 1) 60%, hsla(260, 60%, 60%, 1) 90%, hsla(260, 60%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(15, 70%, 35%, 1) 60%, hsla(35, 70%, 60%, 1) 90%, hsla(50, 70%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(135, 60%, 27%, 1) 60%, hsla(135, 60%, 60%, 1) 90%, hsla(135, 60%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(300, 60%, 30%, 1) 60%, hsla(300, 60%, 60%, 1) 90%, hsla(300, 60%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(10, 60%, 30%, 1) 60%, hsla(10, 60%, 60%, 1) 90%, hsla(10, 60%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(85, 60%, 27%, 1) 60%, hsla(85, 60%, 60%, 1) 90%, hsla(85, 60%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(240, 60%, 32%, 1) 60%, hsla(240, 60%, 60%, 1) 90%, hsla(240, 60%, 80%, 1) 100%)",
    "linear-gradient(15deg, hsla(342, 60%, 30%, 1) 60%, hsla(342, 60%, 60%, 1) 90%, hsla(342, 60%, 80%, 1) 100%)"
]

keyToId = {
    90:"C2",88:"D2",67:"E2",86:"F2",66:"G2",78:"A2",77:"B2",188:"C3",
    65:"C3",83:"D3",68:"E3",70:"F3",71:"G3",72:"A3",74:"B3",75:"C4",
    81:"C4",87:"D4",69:"E4",82:"F4",84:"G4",89:"A4",85:"B4",73:"C5",
    49:"C5",50:"D5",51:"E5",52:"F5",53:"G5",54:"A5",55:"B5",56:"C6",
};

keyToMidi = {
    90:"36",88:"38",67:"40",86:"41",66:"43",78:"45",77:"47",188:"48",
    65:"48",83:"50",68:"52",70:"53",71:"55",72:"57",74:"59",75:"60",
    81:"60",87:"62",69:"64",82:"65",84:"67",89:"69",85:"71",73:"72",
    49:"72",50:"74",51:"76",52:"77",53:"79",54:"81",55:"83",56:"84",
};

midiToId = {
    21:"A0",22:"As0",23:"B0",
    24:"C1",25:"Cs1",26:"D1",27:"Ds1",28:"E1",29:"F1",30:"Fs1",31:"G1",32:"Gs1",33:"A1",34:"As1",35:"B1",
    36:"C2",37:"Cs2",38:"D2",39:"Ds2",40:"E2",41:"F2",42:"Fs2",43:"G2",44:"Gs2",45:"A2",46:"As2",47:"B2",
    48:"C3",49:"Cs3",50:"D3",51:"Ds3",52:"E3",53:"F3",54:"Fs3",55:"G3",56:"Gs3",57:"A3",58:"As3",59:"B3",
    60:"C4",61:"Cs4",62:"D4",63:"Ds4",64:"E4",65:"F4",66:"Fs4",67:"G4",68:"Gs4",69:"A4",70:"As4",71:"B4",
    72:"C5",73:"Cs5",74:"D5",75:"Ds5",76:"E5",77:"F5",78:"Fs5",79:"G5",80:"Gs5",81:"A5",82:"As5",83:"B5",
    84:"C6",85:"Cs6",86:"D6",87:"Ds6",88:"E6",89:"F6",90:"Fs6",91:"G6",92:"Gs6",93:"A6",94:"As6",95:"B6",
    96:"C7",97:"Cs7",98:"D7",99:"Ds7",100:"E7",101:"F7",102:"Fs7",103:"G7",104:"Gs7",105:"A7",106:"As7",107:"B7",
    108:"C8"
};

let channelFilter = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];

// let Cfclk = [false, false, false, false];
// let Cfclk1 = false;
// let Cfclk2 = false;
// let Cfclk3 = false;
// let Cfclk4 = false;




harmonicRatio = [
    1.0246079839113384, 1.1582997098203605, 1.1388447671472606, 1.1719544344534898, 1.2164137280584002, 1.0685639213044205, 0.9537010802260389, 0.9815681183973349,
    1.143244941182331, 1.1561880403503995, 1.1476663400547313, 1.1488029936757953, 1.086872695255089, 1.0984287975472282, 0.966653131230532, 1.0410188843390245,
    1.0037683465770395, 1.007146205285253, 0.9409009523639191, 0.9947457664048427, 0.9617784723323823, 0.9045326670684404, 0.8582613131924376, 0.8960555096076478,
    0.972055638107516, 0.9406779746094587, 0.9123789973452026, 0.7965213763826684, 0.8156965567579568, 0.8139021629575786, 0.7697647600840131, 0.7556845067402741,
    0.882455242070097, 0.8458030984856008, 0.8131982403201687, 0.7372657252860997, 0.7216073464462383, 0.6651998103877568, 0.6578420005135593, 0.6575283835590198,
    0.8977268467056416, 0.7558446396734972, 0.7342616083010517, 0.7010909092023433, 0.6643503248668519, 0.6370964804339656, 0.6227372142121878, 0.5929093698600671,
    0.8889964200480135, 0.7591102317460732, 0.6326798492952872, 0.656574107019366, 0.6901026344225969, 0.6834339185789894, 0.6229595254229808, 0.5995726627791448,
    0.7771693877901827, 0.6678207346454161, 0.44054758723425014, 0.5715067781055962,0,0,0,0
];